<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>DCSO</title>
  <link rel="icon" type="image/png" href="https://i.postimg.cc/BQ4VKs5q/BADGE-1.png">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --page-max: 1120px;
      --surface: rgba(8, 10, 16, 0.7);
      --surface-soft: rgba(10, 12, 20, 0.62);
      --surface-faint: rgba(14, 16, 26, 0.52);
      --border: rgba(212, 175, 55, 0.22);
      --border-strong: rgba(212, 175, 55, 0.38);
      --text: #f6f6f6;
      --text-muted: rgba(220, 220, 220, 0.78);
      --accent: #d4af37;
      --accent-strong: #b8941e;
      --accent-soft: rgba(212, 175, 55, 0.18);
      --accent-contrast: #050505;
      --radius-lg: 20px;
      --radius-sm: 12px;
      --shadow: 0 18px 38px rgba(0, 0, 0, 0.82);
      --grid-gap: clamp(1rem, 2vw, 1.6rem);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Manrope', sans-serif;
      color: var(--text);
      background-color: #04060a;
      min-height: 100vh;
      padding: clamp(1.5rem, 4vw, 3rem) clamp(1rem, 4vw, 2rem) 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow-x: hidden;
    }

    .background {
      position: fixed;
      inset: 0;
      z-index: -3;
      pointer-events: none;
      overflow: hidden;
    }

    .background::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 20%, rgba(6, 9, 14, 0.18), transparent 55%),
                  radial-gradient(circle at 80% 15%, rgba(6, 8, 12, 0.16), transparent 45%),
                  linear-gradient(140deg, rgba(4, 6, 10, 0.42), rgba(4, 6, 10, 0.08));
      mix-blend-mode: multiply;
    }

    .background picture,
    .background img {
      width: 100vw;
      height: 100vh;
      display: block;
    }

    .background img {
      object-fit: cover;
      transform: translateZ(0);
      filter: none;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: optimizeQuality;
      will-change: transform;
    }


    .page {
      width: min(100%, var(--page-max));
      display: flex;
      flex-direction: column;
      gap: clamp(1.5rem, 3vw, 2.5rem);
    }

    .masthead {
      display: grid;
      gap: 1rem;
      justify-items: center;
      text-align: center;
      padding: 1rem 0;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.5rem 1.2rem;
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      background: var(--surface-soft);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.8);
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-size: 0.7rem;
    }

    .badge img {
      height: 28px;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.7));
    }

    h1 {
      font-family: 'Cinzel', serif;
      font-size: clamp(2rem, 5vw, 3.2rem);
      line-height: 1.1;
      text-shadow: 0 15px 30px rgba(0, 0, 0, 0.9);
      margin: 0.5rem 0;
    }

    h2,
    h3,
    h4 { font-family: 'Cinzel', serif; }

    .subtitle {
      font-family: 'Cinzel', serif;
      max-width: 640px;
      color: var(--text-muted);
      font-size: clamp(0.95rem, 2vw, 1.05rem);
      line-height: 1.6;
    }

    .layout {
      display: grid;
      gap: 1.5rem;
    }

    .surface {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
    }

    .workspace {
      display: grid;
      gap: var(--grid-gap);
    }

    .workspace__main {
      display: grid;
      gap: var(--grid-gap);
    }

    .section-header {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1.5rem 1.5rem 1rem;
      border-bottom: 1px solid var(--border);
    }

    .section-switcher {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.75rem;
    }

    .section-switcher label {
      font-size: 0.7rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
      font-weight: 600;
    }

    .select-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
    }

    .select-wrapper::after {
      content: '▾';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--accent);
      pointer-events: none;
      font-size: 0.75rem;
    }

    .section-switcher select {
      min-width: 200px;
      padding: 0.6rem 2.5rem 0.6rem 1rem;
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      background: var(--surface-faint);
      color: var(--text);
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      transition: all 0.2s ease;
      appearance: none;
      cursor: pointer;
    }

    .section-switcher select:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .section-switcher select option,
    .template-select select option {
      background-color: #0a0a0c;
      color: var(--text);
    }

    .panels {
      padding: 1.5rem;
    }

    .panel {
      display: none;
      flex-direction: column;
      gap: 1.5rem;
      animation: fadeUp 0.3s ease;
    }

    .panel.active { display: flex; }

    .template-panel {
      display: grid;
      gap: 1.2rem;
    }

    .template-select {
      display: grid;
      gap: 0.6rem;
    }

    .template-select select {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--surface-faint);
      color: var(--text);
      font-weight: 500;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .template-select select:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .template-description {
      color: var(--text-muted);
      font-size: 0.9rem;
      line-height: 1.5;
      min-height: 1.5rem;
      padding: 0.5rem 0;
    }

    .dynamic-grid textarea {
      min-height: 160px;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .panel header h2 {
      font-size: clamp(1.3rem, 2.5vw, 1.6rem);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group.wide {
      grid-column: 1 / -1;
    }

    label {
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      color: rgba(230, 230, 230, 0.9);
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 0.75rem 0.9rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--surface-faint);
      color: var(--text);
      font-size: 0.95rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(200, 200, 200, 0.35);
    }

    select {
      cursor: pointer;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    textarea {
      min-height: 140px;
      resize: vertical;
      line-height: 1.5;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 0.5rem;
    }

    .generate-btn {
      padding: 0.85rem 1.6rem;
      border-radius: var(--radius-sm);
      border: none;
      background: linear-gradient(135deg, var(--accent-strong), var(--accent));
      color: var(--accent-contrast);
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
    }

    .generate-btn::after {
      content: '↗';
      font-size: 1.1rem;
      transition: transform 0.2s ease;
    }

    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(212, 175, 55, 0.45);
    }

    .generate-btn:hover::after {
      transform: translateX(3px);
    }

    .resources {
      display: grid;
      gap: var(--grid-gap);
    }

    .resources h2 {
      font-size: clamp(1.2rem, 2.3vw, 1.5rem);
      font-weight: 600;
      padding: 1.5rem 1.5rem 0;
    }

    .resource-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      padding: 0 1.5rem 1.5rem;
    }

    .resource {
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      overflow: hidden;
      background: var(--surface-faint);
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
    }

    .resource:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 35px rgba(212, 175, 55, 0.25);
      border-color: var(--border-strong);
    }

    .resource img {
      width: 100%;
      display: block;
      aspect-ratio: 16 / 9;
      object-fit: cover;
    }

    .resource figcaption {
      padding: 0.9rem 1rem;
      color: var(--text-muted);
      font-size: 0.85rem;
      line-height: 1.5;
    }

    footer {
      display: grid;
      gap: 0.8rem;
      justify-items: center;
      padding: 1.5rem 0 1rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .footer-seal {
      width: min(140px, 30vw);
      padding: 1rem 1.4rem;
      background: var(--surface-soft);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      display: flex;
      justify-content: center;
    }

    .footer-seal img {
      width: 100%;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.7));
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 0.8rem 1.3rem;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent-strong), var(--accent));
      color: var(--accent-contrast);
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
      opacity: 0;
      pointer-events: none;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 99;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    @media (min-width: 1024px) {
      .layout {
        grid-template-columns: minmax(0, 2.2fr) minmax(0, 1fr);
        align-items: start;
      }
    }

    @media (max-width: 720px) {
      body {
        padding: 1rem;
      }

      .section-header {
        padding: 1.2rem;
      }

      .panels {
        padding: 1.2rem;
      }

      .form-actions {
        flex-direction: column;
      }

      .generate-btn {
        width: 100%;
        justify-content: center;
      }

      .resource-grid {
        grid-template-columns: 1fr;
        padding: 0 1.2rem 1.2rem;
      }

      .resources h2 {
        padding: 1.2rem 1.2rem 0;
      }
    }
  </style>
</head>
<body>
  <div class="background" aria-hidden="true">
    <picture>
      <source srcset="https://i.postimg.cc/cJTvsF26/Alex-4.png 3840w" media="(min-width: 2400px)">
      <img
        src="https://i.postimg.cc/cJTvsF26/Alex-4.png"
        srcset="https://i.postimg.cc/cJTvsF26/Alex-4.png 1920w, https://i.postimg.cc/cJTvsF26/Alex-4.png 2560w, https://i.postimg.cc/cJTvsF26/Alex-4.png 3200w, https://i.postimg.cc/cJTvsF26/Alex-4.png 3840w"
        sizes="100vw"
        alt=""
        loading="eager"
        decoding="async">
    </picture>
  </div>
  <div class="page">
    <header class="masthead">
      <div class="badge">
        <img src="https://i.postimg.cc/BQ4VKs5q/BADGE-1.png" alt="Badge Marshal Service">
        Marshal Service
      </div>
      <h1>Marshal Service</h1>
      <p class="subtitle">Marshal Service</p>
    </header>

    <section class="layout">
      <div class="workspace">
        <div class="workspace__main surface">
          <div class="section-header">
            <div class="section-switcher">
              <label for="sectionSelect">Type de rapport</label>
              <div class="select-wrapper">
                <select id="sectionSelect" aria-label="Changer de type de rapport" onchange="showSection(this.value)">
                  <option value="terrain">Field Report</option>
                  <option value="documents">Documents spéciaux</option>
                </select>
              </div>
            </div>
          </div>
          <div class="panels">
            <article id="terrain" class="panel active" role="region" aria-labelledby="terrain-title">
              <header>
                <h2 id="terrain-title">Field Report</h2>
              </header>
              <div class="form-grid">
                <div class="form-group">
                  <label for="reportNum">Numéro de rapport</label>
                  <input id="reportNum" placeholder="Ex: 123">
                </div>
                <div class="form-group">
                  <label for="date">Date</label>
                  <input id="date" placeholder="Ex: 23/10/2025">
                </div>
                <div class="form-group">
                  <label for="name">Nom</label>
                  <input id="name" placeholder="Ex: John Fisheer">
                </div>
                <div class="form-group">
                  <label for="signature">Lien de la signature</label>
                  <input id="signature" placeholder="Ex: https://imgur.com/signature.png">
                </div>
                <div class="form-group">
                  <label for="refNo">File/Case Ref. No.</label>
                  <input id="refNo" placeholder="Ex: 789">
                </div>
                <div class="form-group">
                  <label for="refName">File/Case Ref. Name</label>
                  <input id="refName" placeholder="Ex: Case Alpha">
                </div>
                <div class="form-group">
                  <label for="page">Page</label>
                  <input id="page" placeholder="Ex: 01">
                </div>
                <div class="form-group wide">
                  <label for="content">Contenu du rapport</label>
                  <textarea id="content" placeholder="Texte du rapport..." maxlength="2500"></textarea>
                </div>
              </div>
              <div class="form-actions">
                <button class="generate-btn" onclick="generateTerrainBBCode()">Copier le rapport</button>
              </div>
            </article>


            <article id="documents" class="panel" role="region" aria-labelledby="documents-title">
              <header>
                <h2 id="documents-title">Documents spéciaux</h2>
              </header>
              <div class="template-panel">
                <div class="template-select">
                  <label for="templateSelect">Modèle de document</label>
                  <select id="templateSelect" aria-describedby="templateDescription"></select>
                </div>
                <p id="templateDescription" class="template-description" aria-live="polite"></p>
                <div id="templateFields" class="form-grid dynamic-grid"></div>
                <div class="form-actions">
                  <button class="generate-btn" onclick="generateDocumentBBCode()">Copier le modèle</button>
                </div>
              </div>
            </article>
          </div>
        </div>
      </div>

      <section class="resources surface" aria-label="Ressources utiles">
        <h2>Ressources</h2>
        <div class="resource-grid">
          <a class="resource" href="https://i.postimg.cc/PJ3rV63W/r3XZu-TI.png" target="_blank" rel="noopener">
            <figure>
              <img src="https://i.postimg.cc/PJ3rV63W/r3XZu-TI.png" alt="Procédure de contact">
              <figcaption>Procédure de contact — numéros d'urgence.</figcaption>
            </figure>
          </a>
          <a class="resource" href="https://i.postimg.cc/cJnggN90/Bd-S5K2E.png" target="_blank" rel="noopener">
            <figure>
              <img src="https://i.postimg.cc/cJnggN90/Bd-S5K2E.png" alt="Avis de recherche 1">
              <figcaption>Avis de recherche prioritaire.</figcaption>
            </figure>
          </a>
          <a class="resource" href="https://i.postimg.cc/L8rhMbH1/LKK1i-CV.png" target="_blank" rel="noopener">
            <figure>
              <img src="https://i.postimg.cc/L8rhMbH1/LKK1i-CV.png" alt="Avis de recherche 2">
              <figcaption>Dossier complémentaire — profils associés.</figcaption>
            </figure>
          </a>
        </div>
      </section>
    </section>

    <footer>
      <div class="footer-seal">
        <img src="https://i.postimg.cc/BQ4VKs5q/BADGE-1.png" alt="Sceau Marshal Service">
      </div>
      <p>© 2025 · Marshal Service — Générateur maintenu par <strong>John Fisheer</strong>.</p>
    </footer>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Rapport copié dans le presse-papiers</div>

  <script>
    function showSection(sectionId) {
      document.querySelectorAll('.panel').forEach(panel => {
        panel.classList.toggle('active', panel.id === sectionId);
      });

      const select = document.getElementById('sectionSelect');
      if (select && select.value !== sectionId) {
        select.value = sectionId;
      }
    }

    function resetFields(scope) {
      scope.querySelectorAll('input, textarea, select').forEach(field => {
        field.value = '';
      });
    }

    function showToast() {
      const toast = document.getElementById('toast');
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1800);
    }

    function escapeHtml(value) {
      return (value ?? '').replace(/[&<>"']/g, match => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[match]);
    }

    function formatMultiline(value) {
      return escapeHtml(value).replace(/\r?\n/g, '<br>');
    }

    function getFieldValue(id, multiline = false) {
      const element = document.getElementById(id);
      if (!element) {
        return '';
      }
      return multiline ? formatMultiline(element.value) : escapeHtml(element.value);
    }

    function handleTemplateSelectChange(event) {
      const select = event.target;
      if (select.dataset.allowCustom === 'true' && select.value === '__custom') {
        const previousValue = select.dataset.lastValue || '';
        const customValue = prompt('Valeur personnalisée pour ce champ :', previousValue);

        if (customValue && customValue.trim()) {
          const sanitizedValue = customValue.trim();
          let customOption = select.querySelector('option[data-custom="true"]');
          if (!customOption) {
            customOption = document.createElement('option');
            customOption.dataset.custom = 'true';
            select.appendChild(customOption);
          }
          customOption.value = sanitizedValue;
          customOption.textContent = sanitizedValue;
          select.value = sanitizedValue;
          select.dataset.lastValue = sanitizedValue;
        } else {
          if (previousValue) {
            select.value = previousValue;
          } else {
            select.selectedIndex = 0;
          }
        }
      } else {
        select.dataset.lastValue = select.value;
      }
    }

    const documentTemplates = [];

    documentTemplates.push({
      id: 'vipCover',
      group: 'Première de couverture',
      label: 'Première de couverture',
      description: 'Page de garde officielle du programme pour individus vulnérables.',
      fields: [
        { id: 'fileRefNumber', label: 'File/Case Ref. No.', placeholder: 'X' },
        { id: 'fileRefNameLine1', label: 'File/Case Ref. Name — ligne 1', placeholder: 'X' },
        { id: 'fileRefNameLine2', label: 'File/Case Ref. Name — ligne 2', placeholder: 'X' },
        { id: 'officerLine1', label: 'Officers in charge — ligne 1', placeholder: 'X' },
        { id: 'officerLine2', label: 'Officers in charge — ligne 2', placeholder: 'X' }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: #d2b89a; font-size: 15px; line-height: 1; font-family: sans-serif; letter-spacing: 2px; color: #000000; border: 0px!important; padding: 0px!important;">
<tbody><tr><td align="center" valign="top"><div style="margin: 55px; border: 20px solid #b03746; height: 1225px; padding-top: 55px;"><b><span style="font-size: 25px">DAVIDSON COUNTY SHERIFF'S OFFICE</span>

<img height="200px" src="https://i.imgur.com/O5sbaiB.png"/>

<span style="font-size: 45px">MARSHAL SERVICE</span>

<span style="font-size: 30px; color: #b03746">OFFICE OF SECURITY PROGRAMS
VULNERABLE INDIVIDUAL PROGRAM</span>

<table style="border: 0px solid #000000!important; width: 635px; background-color: #000000; padding: 0px!important"><tbody><tr><td><span style="font-size: 30px; color: #d2b89a; width: 100px"><center>INTERNAL DISSEMINATION ONLY</center></span></td></tr></tbody></table>

<span style="font-size: 20px">CIRCULATION NOTICE:</span>

<table style="border: 4px solid #000000!important; padding: 10px; width: 635px"><tbody><tr><td><span style="font-size: 20px; letter-spacing: 0px; word-spacing: 3px">Materials contained here within are from confidential sources
and contain restricted information. All materials enclosed are
strictly for the internal use of the Marshal Service.</span></td></tr></tbody></table>

FILE/CASE REF. NO.
<table style="border: 0px solid #000000!important; border-bottom: 3px solid #000000!important; width: 450px; height: 40px; padding-top: 5px"><tbody><tr><td><span style="font-size: 35px; font-family: Courier; letter-spacing: 0px"><b><center>{{fileRefNumber}}</center></b></span></td></tr></tbody></table>

FILE/CASE REF. NAME
<span style="font-size: 35px; font-family: Courier; letter-spacing: 0px"><table style="border: 0px solid #000000!important; border-bottom: 3px solid #000000!important; width: 700px; height: 40px; padding-top: 5px"><tbody><tr><td><b><center>{{fileRefNameLine1}}</center></b></td></tr></tbody></table>
<table style="border: 0px solid #000000!important; border-bottom: 3px solid #000000!important; width: 700px; height: 40px; padding-top: 5px"><tbody><tr><td><b><center>{{fileRefNameLine2}}</center></b></td></tr></tbody></table></span>

OFFICERS IN CHARGE
<span style="font-size: 35px; font-family: Courier; letter-spacing: 0px"><table style="border: 0px solid #000000!important; border-bottom: 3px solid #000000!important; width: 500px; height: 40px; padding-top: 5px"><tbody><tr><td><b><center>{{officerLine1}}</center></b></td></tr></tbody></table>
<table style="border: 0px solid #000000!important; border-bottom: 3px solid #000000!important; width: 500px; height: 40px; padding-top: 5px"><tbody><tr><td><b><center>{{officerLine2}}</center></b></td></tr></tbody></table></span>

</b></div></td></tr></tbody></table></center>
</div>`
    });

    documentTemplates.push({
      id: 'vipSummary',
      group: 'Première de couverture',
      label: 'Deuxième de couverture',
      description: "Résumé pelable du dossier avec champs d'identification et requêtes.",
      fields: [
        { id: 'summaryReference', label: 'Matricule de référence', placeholder: 'X' },
        {
          id: 'summaryClassification',
          label: 'Classification',
          type: 'select',
          placeholder: 'Sélectionner…',
          options: [
            { value: 'Confidentiel-Interne', label: 'Confidentiel-Interne' },
            { value: 'Restreint-Interne', label: 'Restreint-Interne' },
            { value: 'Secret-Interne', label: 'Secret-Interne' },
            { value: 'Très Secret-Interne', label: 'Très Secret-Interne' }
          ]
        },
        { id: 'summaryFileNumber', label: 'Numéro de dossier', placeholder: 'X' },
        { id: 'summaryReferenceName', label: 'Nom de référence', placeholder: 'X' },
        { id: 'summaryAgents', label: 'Agents en charge', placeholder: 'X' },
        { id: 'summaryBureau', label: 'Bureau concerné', placeholder: 'X' },
        { id: 'summaryCell', label: 'Cellule concernée', placeholder: 'X' },
        { id: 'summaryOpeningDate', label: "Date d'ouverture", placeholder: 'X' },
        { id: 'requestApplicant', label: 'Requérant', placeholder: 'X' },
        { id: 'requestCivility', label: 'Civilité', placeholder: 'X' },
        { id: 'requestEmissionDate', label: "Date d'émission", placeholder: 'X' },
        { id: 'requestEmissionTime', label: "Heure d'émission", placeholder: 'X' },
        { id: 'requestResponder', label: 'Répondant', placeholder: 'X' }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: #d2b89a; font-size: 15px; line-height: 1; font-family: sans-serif; color: #000000; border: 0px!important; padding: 0px!important;">
<tbody><tr><td align="center" valign="top"><div style="background: white; padding: 30px; padding-top: 20px; width: 500px; color: darkred; margin-top: 150px;"><table style="padding: 0px!important; border: 0px!important"><tr><td style="text-align: center; width: 300px;">PEEL HERE
▼</td><td style="text-align: center; width: 300px;">PEEL HERE
▼</td></tr></table>

<span style="font-size: 30px; letter-spacing: 5px; font-weight: bold;">- FILE SUMMARY -</span>
<br><div style="border: 2px solid darkred; padding: 15px; text-align: left; font-size: 12px; line-height: 25px;"><b>Matricule de référence :</b> {{summaryReference}}<br>
<b>Classification :</b> {{summaryClassification}}<br>
<b>Numéro de dossier :</b> {{summaryFileNumber}}<br>
<b>Nom de référence :</b> {{summaryReferenceName}}<br>
<b>Agents en charge :</b> {{summaryAgents}}<br>
<b>Bureau concerné :</b> {{summaryBureau}}<br>
<b>Cellule concernée :</b> {{summaryCell}}<br>
<b>Date d'ouverture :</b> {{summaryOpeningDate}}</div><div style="font-size: 15px; font-weight: bold; margin: 5px;">- REQUEST -</div><div style="border: 2px solid darkred; padding: 15px; text-align: left; font-size: 12px; line-height: 25px;"><b>Requérant :</b> {{requestApplicant}}<br>
<b>Civilité :</b> {{requestCivility}}<br>
<b>Date d'émission :</b> {{requestEmissionDate}}<br>
<b>Heure d'émission :</b> {{requestEmissionTime}}<br>
<b>Répondant :</b> {{requestResponder}}</div></div></td></tr></tbody></table></center>
</div>`
    });

    const officialFields = [
      { id: 'officialFileNumber', label: 'File/Case Ref. No.', placeholder: 'XXX' },
      { id: 'officialDate', label: 'Date', placeholder: 'XX/XX/XXXX' },
      { id: 'officialFileName', label: 'File/Case Ref. Name', placeholder: 'XXX' },
      { id: 'officialReviewDate', label: 'Review Date', placeholder: 'XX/XX/XXXX' }
    ];

    documentTemplates.push({
      id: 'officialGreen',
      group: 'Page de garde',
      label: 'Confidential-Interne',
      description: 'Pochette scellée niveau Confidential-Interne.',
      fields: [...officialFields],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 0px!important; font-family: georgia; color: #000000">
<tbody><tr><td align="center" valign="top"><div style="margin: 20px;border: 75px solid #197239; height: 1295px; padding: 10px;">OFFICIAL DOCUMENT
<div style="letter-spacing: 2px; font-size: 20px; font-weight: bold; margin-top: 15px;">DAVIDSON COUNTY SHERIFF'S OFFICE</div>
<div style="font-weight: bold; color: #197239; font-size: 35px; margin-bottom: 50px; margin-top: 5px;">SENSITIVE DOCUMENTS ENCLOSED</div><img src="https://i.imgur.com/O5sbaiB.png" height="250px;">
<div style="font-weight: bold; color: #197239; font-size: 40px; margin-top: 50px;">EYES ONLY</div>
<div style="letter-spacing: 2px; font-size: 25px; margin-top: 10px;">DO NOT DUPLICATE</div>
<div style="font-size: 30px; font-family: sans-serif; color: #197239; font-weight: bold; line-height: 35px;">MARSHAL SERVICE
INVESTIGATION DIVISION


CLASSIFIED DOCUMENTS ENCLOSED</div>
<span style="font-size: 20px; color: #197239; font-weight: bold;">CONFIDENTIAL - INTERNAL</span>
<div style="margin-top: 285px; text-align: left;"><center>FOR OFFICIAL USE ONLY</center>
File/Case Ref. No. # {{officialFileNumber}} <div style="float:right;">Date: {{officialDate}}</div>

File/Case Ref. Name: {{officialFileName}} <div style="float:right;">Review Date: {{officialReviewDate}}</div></div></div></div></td></tr></tbody></table></center>
</div>`
    });

    documentTemplates.push({
      id: 'officialBlue',
      group: 'Page de garde',
      label: 'Restrictif-Interne',
      description: 'Pochette scellée niveau Restrictif-Interne.',
      fields: [...officialFields],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 0px!important; font-family: georgia; color: #000000">
<tbody><tr><td align="center" valign="top"><div style="margin: 20px;border: 75px solid #315aa8; height: 1295px; padding: 10px;">OFFICIAL DOCUMENT
<div style="letter-spacing: 2px; font-size: 20px; font-weight: bold; margin-top: 15px;">DAVIDSON COUNTY SHERIFF'S OFFICE</div>
<div style="font-weight: bold; color: #315aa8; font-size: 35px; margin-bottom: 50px; margin-top: 5px;">SENSITIVE DOCUMENTS ENCLOSED</div><img src="https://i.imgur.com/O5sbaiB.png" height="250px;">
<div style="font-weight: bold; color: #315aa8; font-size: 40px; margin-top: 50px;">EYES ONLY</div>
<div style="letter-spacing: 2px; font-size: 25px; margin-top: 10px;">DO NOT DUPLICATE</div>
<div style="font-size: 30px; font-family: sans-serif; color: #315aa8; font-weight: bold; line-height: 35px;">MARSHAL SERVICE
INVESTIGATION DIVISION


CLASSIFIED DOCUMENTS ENCLOSED</div>
<span style="font-size: 20px; color: #315aa8; font-weight: bold;">RESTRICTED - INTERNAL</span>
<div style="margin-top: 285px; text-align: left;"><center>FOR OFFICIAL USE ONLY</center>
File/Case Ref. No. # {{officialFileNumber}} <div style="float:right;">Date: {{officialDate}}</div>

File/Case Ref. Name: {{officialFileName}} <div style="float:right;">Review Date: {{officialReviewDate}}</div></div></div></div></td></tr></tbody></table></center>
</div>`
    });

    documentTemplates.push({
      id: 'officialRed',
      group: 'Page de garde',
      label: 'Secret-Interne',
      description: 'Pochette scellée niveau Secret-Interne.',
      fields: [...officialFields],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 0px!important; font-family: georgia; color: #000000">
<tbody><tr><td align="center" valign="top"><div style="margin: 20px;border: 75px solid #d43e4b; height: 1295px; padding: 10px;">OFFICIAL DOCUMENT
<div style="letter-spacing: 2px; font-size: 20px; font-weight: bold; margin-top: 15px;">DAVIDSON COUNTY SHERIFF'S OFFICE</div>
<div style="font-weight: bold; color: #d43e4b; font-size: 35px; margin-bottom: 50px; margin-top: 5px;">SENSITIVE DOCUMENTS ENCLOSED</div><img src="https://i.imgur.com/O5sbaiB.png" height="250px;">
<div style="font-weight: bold; color: #d43e4b; font-size: 40px; margin-top: 50px;">EYES ONLY</div>
<div style="letter-spacing: 2px; font-size: 25px; margin-top: 10px;">DO NOT DUPLICATE</div>
<div style="font-size: 30px; font-family: sans-serif; color: #d43e4b; font-weight: bold; line-height: 35px;">MARSHAL SERVICE
INVESTIGATION DIVISION


CLASSIFIED DOCUMENTS ENCLOSED</div>
<span style="font-size: 20px; color: #d43e4b; font-weight: bold;">SECRET - INTERNAL</span>
<div style="margin-top: 285px; text-align: left;"><center>FOR OFFICIAL USE ONLY</center>
File/Case Ref. No. # {{officialFileNumber}} <div style="float:right;">Date: {{officialDate}}</div>

File/Case Ref. Name: {{officialFileName}} <div style="float:right;">Review Date: {{officialReviewDate}}</div></div></div></div></td></tr></tbody></table></center>
</div>`
    });

    documentTemplates.push({
      id: 'officialOrange',
      group: 'Page de garde',
      label: 'Très Secret-Interne',
      description: 'Pochette scellée niveau Très Secret-Interne.',
      fields: [...officialFields],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 0px!important; font-family: georgia; color: #000000">
<tbody><tr><td align="center" valign="top"><div style="margin: 20px;border: 75px solid #f2624f; height: 1295px; padding: 10px;">OFFICIAL DOCUMENT
<div style="letter-spacing: 2px; font-size: 20px; font-weight: bold; margin-top: 15px;">DAVIDSON COUNTY SHERIFF'S OFFICE</div>
<div style="font-weight: bold; color: #f2624f; font-size: 35px; margin-bottom: 50px; margin-top: 5px;">SENSITIVE DOCUMENTS ENCLOSED</div><img src="https://i.imgur.com/O5sbaiB.png" height="250px;">
<div style="font-weight: bold; color: #f2624f; font-size: 40px; margin-top: 50px;">EYES ONLY</div>
<div style="letter-spacing: 2px; font-size: 25px; margin-top: 10px;">DO NOT DUPLICATE</div>
<div style="font-size: 30px; font-family: sans-serif; color: #f2624f; font-weight: bold; line-height: 35px;">MARSHAL SERVICE
INVESTIGATION DIVISION


CLASSIFIED DOCUMENTS ENCLOSED</div>
<span style="font-size: 20px; color: #f2624f; font-weight: bold;">TOP SECRET - INTERNAL</span>
<div style="margin-top: 285px; text-align: left;"><center>FOR OFFICIAL USE ONLY</center>
File/Case Ref. No. # {{officialFileNumber}} <div style="float:right;">Date: {{officialDate}}</div>

File/Case Ref. Name: {{officialFileName}} <div style="float:right;">Review Date: {{officialReviewDate}}</div></div></div></div></td></tr></tbody></table></center>
</div>`
    });

    documentTemplates.push({
      id: 'contractIndividual',
      group: 'Contrat de protection personnelle',
      label: 'Personne physique',
      description: 'Version individuelle du contrat de protection personnelle.',
      fields: [
        { id: 'documentDate', label: 'Date du document', placeholder: 'January 1, 2024' },
        { id: 'recipientName', label: 'Rédacteur - Nom', placeholder: 'Prénom Nom', preserve: true },
        { id: 'recipientRole', label: 'Rédacteur - Fonction', placeholder: 'Deputy Marshal of the Marshal Service', preserve: true },
        { id: 'recipientOfficeLine2', label: 'Rédacteur - Localisation', placeholder: 'Nashville, TN', preserve: true },
        { id: 'protegeCivility', label: 'Civilité du Protégé', placeholder: 'Civilité' },
        { id: 'protegeFullName', label: 'Nom complet du Protégé', placeholder: 'Prénom Nom' },
        { id: 'protegeBirthDate', label: 'Date de naissance du Protégé', placeholder: 'XX/XX/XXXX' },
        { id: 'protegeBirthPlace', label: 'Lieu de naissance du Protégé', placeholder: 'Ville (Etat)' },
        { id: 'protegeNationality', label: 'Nationalité du Protégé', placeholder: 'Nationalité' },
        { id: 'protegeAddress', label: 'Adresse du Protégé', placeholder: 'Adresse complète' },
        { id: 'engagementDate', label: "Date d'engagement", placeholder: '00/00/2025' },
        { id: 'signatureCity', label: 'Ville de signature', placeholder: 'Nashville' },
        { id: 'signatureDate', label: 'Date de signature', placeholder: 'XX/XX/XXXX' },
        { id: 'protegeSignatureLink', label: 'Signature du Protégé (lien image)', placeholder: 'LIEN A METTRE ICI' },
        { id: 'protecteurSignatureLink', label: 'Signature du Protecteur (lien image)', placeholder: 'LIEN A METTRE ICI' }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: #ffffff; font-family: Times New Roman; font-size: 18px; line-height: 1; color: #000000; padding: 30px"><tbody><tr><td valign="top"><table style="border: 0px solid #000000!important; font-size: 20px"><tbody><tr><td><img height="120px" src="https://i.imgur.com/jDodmWK.png"></td><td style="padding-left: 345px"><b>Marshal Service</b><br><br><i>Office of Security Programs</i></td></tr></tbody></table>
<hr style="border-top: 1px solid #000000;"><span style="padding-left: 470px;  font-size: 16px"><i>Nashville, TN 37201</i></span>


<span style="padding-left: 470px">{{documentDate}}</span>


{{recipientName}}
{{recipientRole}}
Davidson County Sheriff's Office
{{recipientOfficeLine2}}


<span style="font-size: 24px;"><center><b>CONTRAT DE PROTECTION PERSONELLE</b></center></span>

<b>Entre les soussigné(e)s :</b>


Le Marshal Service de l'Investigation Division du Davidson County Sheriff's Office dont le siège social est situé One Jerry Newson Way, Nashville, TN 37201, représenté par John Labour, en sa qualité de Directeur,

Ci-après dénommée le <b>"Protecteur"</b>,


<b>Et</b>

{{protegeCivility}} {{protegeFullName}}, né(e) le {{protegeBirthDate}} à {{protegeBirthPlace}}, de nationalité {{protegeNationality}}, demeurant au {{protegeAddress}},

Ci-après dénommée le <b>"Protégé"</b>.


Il a été conclu le présent engagement d'un commun accord entre les parties, conformément aux dispositions légales.


<span style="font-size: 24px;"><b>ARTICLE 1 - ENGAGEMENT</b></span>

A compter du {{engagementDate}}, date de signature du contrat, le Protégé s'engage à prévenir au minimum 48 heures à l'avance de sa nécessité à bénéficier des services de protection contenant toutes les informations requises à sa mise en place.

Dans le cas où le Protégé ne respecte pas ce délai minimum, le Protecteur fera le nécessaire afin de garantir les services de protection mais se réserve le droit, s'il le juge légitime et suffisamment motivé, de ne pas assurer la protection attendue.


<span style="font-size: 24px;"><b>ARTICLE 2 - DUREE DU CONTRAT</b></span>

Le contrat de protection personnelle du Protégé est un contrat à durée indéterminée et pourra prendre fin, à toute époque, de la volonté de l'une ou l'autres des parties, sous réserve du respect des délais de préavis légaux ou conventionnels applicables.


<span style="font-size: 24px;"><b>ARTICLE 3 - RUPTURE DU CONTRAT - RESTITUTION </b></span>

Le présent contrat ne pourra être rompu avant l'arrivée du terme qu'en cas de :
<ul><li>faute grave ou lourde du Protégé,</li><li>force majeure,</li><li>accord entre les deux parties,</li><li>justification par le Protégé de sa protection sous contrat à durée indéterminée.</li></ul>Il prendra fin, le cas échéant, automatiquement et sans formalité au terme susvisé à l'Article 2.

Tous les documents établis par le Protégé ainsi que tous équipements professionnels et documents confiés à celui-ci dans le cadre de son statut, resteront la propriété du Protecteur. </td></tr></tbody></table>

<table style="width: 1005px; height: 1340px; background-color: #ffffff; font-family: Times New Roman; font-size: 18px; line-height: 1; color: #000000; padding: 30px"><tbody><tr><td valign="top">Le Protégé s'engage expressément à restituer ou céder, le jour même de la cessation de son statut au sein du Protecteur, sans qu'il soit nécessaire d'une démarche ou d'une mise en demeure préalable du Protecteur, tout support de quelque nature que ce soit et notamment, sans que cette liste soit limitative, tous documents, copies, disquettes en sa possession, ainsi que tout matériel ou fourniture qui lui aura été confiés.


<span style="font-size: 24px;"><b>ARTICLE 4 - ABSENCES</b></span>

En cas d’absence prévisible, le Protégé sollicitera l’autorisation auprès du/des opérateur(s) en charge ou de toute personne dûment mandatée.

En cas d’absence imprévisible, le Protégé sera tenu de prévenir ou de faire prévenir immédiatement le(s) opérateur(s) en charge ou toute personne dûment mandatée.


<span style="font-size: 24px;"><b>ARTICLE 5 - RESPONSABILITE</b></span>

Le Protecteur tien entière responsabilité vis-à-vis du Protégé dès lors que les services de protection sont requis et que la présente requête a été traitée impliquant la présence physique d'opérateurs chargés d'honorer ces services.

Cette responsabilité relève également, dans le cadre d'une protection, d'un pouvoir discrétionnaire concernant les déplacements, les demandes ou toute autre action que le Protégé a prévu ou souhaite entreprendre.

Le Protecteur doit avoir la possibilité d'indiquer quoi faire mais également quand et où et de statuer lorsque nécessaire dans le dessein d'assurer la sécurité du Protégé.


<span style="font-size: 24px;"><b>ARTICLE 6 - CLAUSE D'EXCLUSIVITE</b></span>

Le Protecteur interdit au Protégé de demander et jouir des services de protection d'un autre Protecteur pendant l'exécution de son contrat.

Cette clause constitue une clause essentielle du présent contrat et tout manquement à cette obligation d'exclusivité est susceptible de constituer une faute grave entraînant la rupture anticipée du présent contrat.


<span style="font-size: 24px;"><b>ARTICLE 7 - OBLIGATION DE CONFIDENTIALITE</b></span>

Au cours de l'exécution du présent contrat et après sa cessation pour quelque cause que ce soit pendant une durée de 10 ans, le Protégé sera tenu à une discrétion absolue sur tous les faits, événements, documents ou renseignements dont il/elle aurait eu connaissance en raison de son statut ou de son appartenance au Protecteur, et qui concerne tant sa gestion et son fonctionnement que son savoir-faire et ses projets et clients.

Cette clause constitue une clause essentielle du présent contrat et tout manquement à l'obligation de réserve est susceptible de constituer une faute grave entraînant la rupture anticipée du présent contrat et engageant la responsabilité du Protégé à l'égard du Protecteur.


<span style="font-size: 24px;"><b>ARTICLE 8 - MATERIELS ET DOCUMENTS</b></span>

Le Protecteur pourra être amené à confier au Protégé des produits, matériels, plans, fichiers et documents divers. Il s'interdit expressément d'en faire un autre usage que celui autorisé par son protecteur et s'engage à les lui présenter ou les lui restituer sur simple demande.


<span style="font-size: 24px;"><b>ARTICLE 9 - DECLARATIONS DIVERSES</b></span>

Le Protégé, à la signature des présentes, déclare être libre de tout engagement, notamment d'exclusivité, et de toute obligation de non-partage de responsabilité de protection.

Toute fausse déclaration à ce sujet étant susceptible d'entraîner la rupture du présent contrat de protection personnelle.

Le Protégé, devra faire connaître au Protecteur, sans délai, toute modification postérieure à son engagement qui pourrait intervenir dans son état civil, sa situation de famille, son adresse, etc.</td></tr></tbody></table>

<table style="width: 1005px; height: 1340px; background-color: #ffffff; font-family: Times New Roman; font-size: 18px; line-height: 1; color: #000000; padding: 30px"><tbody><tr><td valign="top">Fait en double exemplaire, dont un est remis à chacune des parties,

A {{signatureCity}}, le {{signatureDate}}.


<img src="{{protegeSignatureLink}}" alt="Signature">


Lu et approuvé - Bon pour accord

Le Protégé*

{{protegeCivility}} {{protegeFullName}}


<img src="{{protecteurSignatureLink}}" alt="Signature">


Lu et approuvé - Bon pour accord

Pour le Protecteur (Marshal Service)

John Labour, Directeur



<b>* Faire précéder la signature du Protégé de la mention "Lu et approuvé - Bon pour accord"

<i>Les deux parties doivent parapher chaque page et signer la page de signature</i></b></td></tr></table></center>
</div>`
    });

    documentTemplates.push({
      id: 'contractCorporate',
      group: 'Contrat de protection personnelle',
      label: 'Personne morale',
      description: 'Version corporate du contrat de protection personnelle.',
      fields: [
        { id: 'documentDate', label: 'Date du document', placeholder: 'January 1, 2024' },
        { id: 'recipientName', label: 'Rédacteur - Nom', placeholder: 'Prénom Nom', preserve: true },
        { id: 'recipientRole', label: 'Rédacteur - Fonction', placeholder: 'Deputy Marshal of the Marshal Service', preserve: true },
        { id: 'recipientOfficeLine2', label: 'Rédacteur - Localisation', placeholder: 'Nashville, TN', preserve: true },
        { id: 'companyName', label: 'Dénomination sociale', placeholder: 'Nom de la société' },
        { id: 'companySector', label: "Secteur d'activité", placeholder: 'Secteur' },
        { id: 'companyAddress', label: 'Adresse du siège social', placeholder: 'Adresse complète' },
        { id: 'companyRepresentativeName', label: 'Représentant de la société', placeholder: 'Prénom Nom' },
        { id: 'companyRepresentativeRole', label: 'Fonction du représentant', placeholder: 'Fonction' },
        { id: 'engagementDate', label: "Date d'engagement", placeholder: '00/00/2025' },
        { id: 'signatureCity', label: 'Ville de signature', placeholder: 'Nashville' },
        { id: 'signatureDate', label: 'Date de signature', placeholder: 'XX/XX/XXXX' },
        { id: 'companySignatureLink', label: 'Signature du Protégé (entreprise)', placeholder: 'LIEN A METTRE ICI' },
        { id: 'companySignatureName', label: 'Nom signataire entreprise', placeholder: 'Prénom Nom' },
        { id: 'companySignatureRole', label: 'Fonction signataire entreprise', placeholder: 'Fonction' },
        { id: 'protecteurSignatureLink', label: 'Signature du Protecteur (lien image)', placeholder: 'LIEN A METTRE ICI' }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: #ffffff; font-family: Times New Roman; font-size: 18px; line-height: 1; color: #000000; padding: 30px"><tbody><tr><td valign="top"><table style="border: 0px solid #000000!important; font-size: 20px"><tbody><tr><td><img height="120px" src="https://i.imgur.com/jDodmWK.png"></td><td style="padding-left: 345px"><b>Marshal Service</b><br><br><i>Office of Security Programs</i></td></tr></tbody></table>
<hr style="border-top: 1px solid #000000;"><span style="padding-left: 470px;  font-size: 16px"><i>Nashville, TN 37201</i></span>


<span style="padding-left: 470px">{{documentDate}}</span>


{{recipientName}}
{{recipientRole}}
Davidson County Sheriff's Office
{{recipientOfficeLine2}}


<span style="font-size: 24px;"><center><b>CONTRAT DE PROTECTION PERSONELLE</b></center></span>

<b>Entre les soussigné(e)s :</b>


Le Marshal Service de l'Investigation Division du Davidson County Sheriff's Office dont le siège social est situé One Jerry Newson Way, Nashville, TN 37201, représenté par John Labour, en sa qualité de Directeur,

Ci-après dénommée le <b>"Protecteur"</b>,


<b>Et</b>

La société {{companyName}}, {{companySector}} dont le siège social est situé {{companyAddress}} représentée par {{companyRepresentativeName}}, en sa qualité de {{companyRepresentativeRole}},

Ci-après dénommée le <b>"Protégé"</b>.


Il a été conclu le présent engagement d'un commun accord entre les parties, conformément aux dispositions légales.


<span style="font-size: 24px;"><b>ARTICLE 1 - ENGAGEMENT</b></span>

A compter du {{engagementDate}}, date de signature du contrat, le Protégé s'engage à prévenir au minimum 48 heures à l'avance de sa nécessité à bénéficier des services de protection contenant toutes les informations requises à sa mise en place.

Dans le cas où le Protégé ne respecte pas ce délai minimum, le Protecteur fera le nécessaire afin de garantir les services de protection mais se réserve le droit, s'il le juge légitime et suffisamment motivé, de ne pas assurer la protection attendue.


<span style="font-size: 24px;"><b>ARTICLE 2 - DUREE DU CONTRAT</b></span>

Le contrat de protection personnelle du Protégé est un contrat à durée indéterminée et pourra prendre fin, à toute époque, de la volonté de l'une ou l'autres des parties, sous réserve du respect des délais de préavis légaux ou conventionnels applicables.


<span style="font-size: 24px;"><b>ARTICLE 3 - RUPTURE DU CONTRAT - RESTITUTION </b></span>

Le présent contrat ne pourra être rompu avant l'arrivée du terme qu'en cas de :
<ul><li>faute grave ou lourde du Protégé,</li><li>force majeure,</li><li>accord entre les deux parties,</li><li>justification par le Protégé de sa protection sous contrat à durée indéterminée.</li></ul>Il prendra fin, le cas échéant, automatiquement et sans formalité au terme susvisé à l'Article 2.

Tous les documents établis par le Protégé ainsi que tous équipements professionnels et documents confiés à celui-ci dans le cadre de son statut, resteront la propriété du Protecteur. </td></tr></tbody></table>

<table style="width: 1005px; height: 1340px; background-color: #ffffff; font-family: Times New Roman; font-size: 18px; line-height: 1; color: #000000; padding: 30px"><tbody><tr><td valign="top">Le Protégé s'engage expressément à restituer ou céder, le jour même de la cessation de son statut au sein du Protecteur, sans qu'il soit nécessaire d'une démarche ou d'une mise en demeure préalable du Protecteur, tout support de quelque nature que ce soit et notamment, sans que cette liste soit limitative, tous documents, copies, disquettes en sa possession, ainsi que tout matériel ou fourniture qui lui aura été confiés.


<span style="font-size: 24px;"><b>ARTICLE 4 - ABSENCES</b></span>

En cas d’absence prévisible, le Protégé sollicitera l’autorisation auprès du/des opérateur(s) en charge ou de toute personne dûment mandatée.

En cas d’absence imprévisible, le Protégé sera tenu de prévenir ou de faire prévenir immédiatement le(s) opérateur(s) en charge ou toute personne dûment mandatée.


<span style="font-size: 24px;"><b>ARTICLE 5 - RESPONSABILITE</b></span>

Le Protecteur tien entière responsabilité vis-à-vis du Protégé dès lors que les services de protection sont requis et que la présente requête a été traitée impliquant la présence physique d'opérateurs chargés d'honorer ces services.

Cette responsabilité relève également, dans le cadre d'une protection, d'un pouvoir discrétionnaire concernant les déplacements, les demandes ou toute autre action que le Protégé a prévu ou souhaite entreprendre.

Le Protecteur doit avoir la possibilité d'indiquer quoi faire mais également quand et où et de statuer lorsque nécessaire dans le dessein d'assurer la sécurité du Protégé.


<span style="font-size: 24px;"><b>ARTICLE 6 - CLAUSE D'EXCLUSIVITE</b></span>

Le Protecteur interdit au Protégé de demander et jouir des services de protection d'un autre Protecteur pendant l'exécution de son contrat.

Cette clause constitue une clause essentielle du présent contrat et tout manquement à cette obligation d'exclusivité est susceptible de constituer une faute grave entraînant la rupture anticipée du présent contrat.


<span style="font-size: 24px;"><b>ARTICLE 7 - OBLIGATION DE CONFIDENTIALITE</b></span>

Au cours de l'exécution du présent contrat et après sa cessation pour quelque cause que ce soit pendant une durée de 10 ans, le Protégé sera tenu à une discrétion absolue sur tous les faits, événements, documents ou renseignements dont il/elle aurait eu connaissance en raison de son statut ou de son appartenance au Protecteur, et qui concerne tant sa gestion et son fonctionnement que son savoir-faire et ses projets et clients.

Cette clause constitue une clause essentielle du présent contrat et tout manquement à l'obligation de réserve est susceptible de constituer une faute grave entraînant la rupture anticipée du présent contrat et engageant la responsabilité du Protégé à l'égard du Protecteur.


<span style="font-size: 24px;"><b>ARTICLE 8 - MATERIELS ET DOCUMENTS</b></span>

Le Protecteur pourra être amené à confier au Protégé des produits, matériels, plans, fichiers et documents divers. Il s'interdit expressément d'en faire un autre usage que celui autorisé par son protecteur et s'engage à les lui présenter ou les lui restituer sur simple demande.


<span style="font-size: 24px;"><b>ARTICLE 9 - DECLARATIONS DIVERSES</b></span>

Le Protégé, à la signature des présentes, déclare être libre de tout engagement, notamment d'exclusivité, et de toute obligation de non-partage de responsabilité de protection.

Toute fausse déclaration à ce sujet étant susceptible d'entraîner la rupture du présent contrat de protection personnelle.

Le Protégé, devra faire connaître au Protecteur, sans délai, toute modification postérieure à son engagement qui pourrait intervenir dans son état civil, sa situation de famille, son adresse, etc.</td></tr></tbody></table>

<table style="width: 1005px; height: 1340px; background-color: #ffffff; font-family: Times New Roman; font-size: 18px; line-height: 1; color: #000000; padding: 30px"><tbody><tr><td valign="top">Fait en double exemplaire, dont un est remis à chacune des parties,

A {{signatureCity}}, le {{signatureDate}}.


<img src="{{companySignatureLink}}" alt="Signature">


Lu et approuvé - Bon pour accord

Le Protégé*

{{companySignatureName}}, {{companySignatureRole}}


<img src="{{protecteurSignatureLink}}" alt="Signature">


Lu et approuvé - Bon pour accord

Pour le Protecteur (Marshal Service)

John Labour, Directeur



<b>* Faire précéder la signature du Protégé de la mention "Lu et approuvé - Bon pour accord"

<i>Les deux parties doivent parapher chaque page et signer la page de signature</i></b></td></tr></table></center>
</div>`
    });

    documentTemplates.push({
      id: 'warningOrder',
      group: 'Ordres',
      label: 'Warning Order',
      description: "Ordre d'avertissement tactique prêt à remplir.",
      fields: [
        { id: 'warningDate', label: 'Date', placeholder: '1 Janvier 2025' },
        { id: 'warningFrom', label: 'From', placeholder: 'X' },
        { id: 'warningTo', label: 'To', placeholder: 'X' },
        { id: 'warningNumber', label: 'Numéro du WARNING ORDER', placeholder: '0' },
        { id: 'warningSituation', label: 'Situation', type: 'textarea', placeholder: 'X', rows: 4 },
        { id: 'warningMission', label: 'Mission', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningChain', label: 'Chaîne de commandement', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningTeams', label: 'Equipes spéciales / organisation', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningUniform', label: 'Uniforme et équipement communs', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningWeapons', label: 'Armes / équipements spéciaux', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningSchedule', label: 'Planning provisoire', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningInstructions', label: 'Instructions générales supplémentaires', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningSpecialSubordinates', label: 'Instructions aux chefs subordonnés', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningSpecialPreparers', label: "Instructions pour la préparation de l'OPORD", type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'warningSignatureLink', label: 'Lien de signature', placeholder: 'SIGNATURE' },
        { id: 'warningSignatureName', label: 'Nom du signataire', placeholder: 'Prénom Nom' }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 35px!important; font-family: Courier; color: #000000;">
<tbody><tr><td align="left" valign="top"><div style="float:left; position: absolute;"><img src="https://i.imgur.com/O5sbaiB.png" height="100px;"></div><br><center><b><div style="font-size: 20px; font-family: georgia;">MARSHAL SERVICE</div><div style="font-size: 10px; line-height: 15px; font-family: georgia;">TACTICAL OPERATIONS CENTER
ONE JERRY NEWSON WAY,
NASHVILLE, TN 37201</div></b></center>

<div style="padding-left: 50px; padding-right: 50px;"><div style="text-align: right;">{{warningDate}}</div>
From: {{warningFrom}}<br>
To: {{warningTo}}<br><br>
Subj: WARNING ORDER #{{warningNumber}}<br><br>
1. <u>Situation :</u> {{warningSituation}}<br><br>
2. <u>Mission :</u> {{warningMission}}<br><br>
3. <u> Instruction générales :</u><br>
a. Chaîne de commandement<br>
{{warningChain}}<br><br>
b. Equipes spéciales/organisation des tâches<br>
{{warningTeams}}<br><br>
c. Uniforme et équipement communs à tous<br>
{{warningUniform}}<br><br>
d. Armes, munitions ou équipements spéciaux<br>
{{warningWeapons}}<br><br>
e. Planning provisoire<br>
{{warningSchedule}}<br><br>
f. Instructions générales supplémentaires<br>
{{warningInstructions}}<br><br>
4. <u>Instructions spéciales</u><br>
a. Aux chefs subordonnés<br>
{{warningSpecialSubordinates}}<br><br>
b. Aux personnes aidant à la préparation de l'OPORD<br>
{{warningSpecialPreparers}}<br><br>

<div style="margin-left: 50%;"><img src="{{warningSignatureLink}}" alt="SIGNATURE" height="100px;">
{{warningSignatureName}}</div></div></td></tr></tbody></table></center></div>`
    });

    documentTemplates.push({
      id: 'operationOrder',
      group: 'Ordres',
      label: 'Operation Order',
      description: "Ordre d'opération complet en quatre sections.",
      fields: [
        { id: 'opordDate', label: 'Date', placeholder: '1 Janvier 2025' },
        { id: 'opordFrom', label: 'From', placeholder: 'X' },
        { id: 'opordTo', label: 'To', placeholder: 'X' },
        { id: 'opordNumber', label: "Numéro de l'OPORD", placeholder: '000' },
        { id: 'opordDescriptor', label: 'Désignation (parenthèses)', placeholder: 'XXX' },
        { id: 'opordAreaInterest', label: "Zone d'intérêt", type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordAreaOperations', label: "Zone d'opération", type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordEnemyForces', label: 'Forces ennemies', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordFriendlyForces', label: 'Forces amies', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordMission', label: 'Mission', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordConcept', label: 'Concept des opérations', type: 'textarea', placeholder: 'X', rows: 4 },
        { id: 'opordTasksManeuver', label: 'Tâches des unités de manœuvre', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordTasksSupport', label: 'Tâches des unités de soutien', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordCoordination', label: 'Instructions de coordination', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordCommand', label: 'Commandement', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordSignal', label: 'Signal', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'opordSignatureLink', label: 'Lien de signature', placeholder: 'SIGNATURE' },
        { id: 'opordSignatureName', label: 'Nom du signataire', placeholder: 'Prénom Nom' }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 35px!important; font-family: Courier; color: #000000;">
<tbody><tr><td align="left" valign="top"><div style="float:left; position: absolute;"><img src="https://i.imgur.com/O5sbaiB.png" height="100px;"></div><br><center><b><div style="font-size: 20px; font-family: georgia;">MARSHAL SERVICE</div><div style="font-size: 10px; line-height: 15px; font-family: georgia;">TACTICAL OPERATIONS CENTER
ONE JERRY NEWSON WAY,
NASHVILLE, TN 37201</div></b></center>

<div style="padding-left: 50px; padding-right: 50px;"><div style="text-align: right;">{{opordDate}}</div>
From: {{opordFrom}}<br>
To: {{opordTo}}<br><br>
Subj: OPERATION ORDER {{opordNumber}} ({{opordDescriptor}})<br><br>
1. <u>Situation :</u><br>
a. Zone d'intérêt<br>
{{opordAreaInterest}}<br><br>
b. Zone d'opération<br>
{{opordAreaOperations}}<br><br>
c. Forces ennemies<br>
{{opordEnemyForces}}<br><br>
d. Forces amies<br>
{{opordFriendlyForces}}<br><br>
2. <u>Mission :</u> {{opordMission}}<br><br>
3. <u>Exécution :</u><br>
a. Concept des opérations<br>
{{opordConcept}}<br><br>
b. Tâches des unités de manœuvre<br>
{{opordTasksManeuver}}<br><br>
c. Tâches des unités de soutien<br>
{{opordTasksSupport}}<br><br>
d. Instructions de coordination<br>
{{opordCoordination}}<br><br>
4. <u>Commandement et signal</u><br>
a. Commandement<br>
{{opordCommand}}<br><br>
b. Signal<br>
{{opordSignal}}<br><br>

<div style="margin-left: 50%;"><img src="{{opordSignatureLink}}" alt="SIGNATURE" height="100px;">
{{opordSignatureName}}</div></div></td></tr></tbody></table></center></div>`
    });

    documentTemplates.push({
      id: 'fragmentaryOrder',
      group: 'Ordres',
      label: 'Fragmentary Order',
      description: 'Ordre fragmentaire (FRAGO) complémentaire à un OPORD.',
      fields: [
        { id: 'fragoDate', label: 'Date', placeholder: '1 Janvier 2025' },
        { id: 'fragoFrom', label: 'From', placeholder: 'X' },
        { id: 'fragoTo', label: 'To', placeholder: 'X' },
        { id: 'fragoNumber', label: 'Numéro du FRAGO', placeholder: '0' },
        { id: 'fragoOpordNumber', label: "Numéro de l'OPORD de référence", placeholder: '000' },
        { id: 'fragoOpordDescriptor', label: "Désignation de l'OPORD (parenthèses)", placeholder: 'XXX' },
        { id: 'fragoSituation', label: 'Situation', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'fragoMission', label: 'Mission', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'fragoExecution', label: 'Exécution', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'fragoSupport', label: 'Assistance technique', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'fragoCommandSignal', label: 'Commandement et signal', type: 'textarea', placeholder: 'X', rows: 3 },
        { id: 'fragoSignatureLink', label: 'Lien de signature', placeholder: 'SIGNATURE' },
        { id: 'fragoSignatureName', label: 'Nom du signataire', placeholder: 'Prénom Nom' }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 35px!important; font-family: Courier; color: #000000;">
<tbody><tr><td align="left" valign="top"><div style="float:left; position: absolute;"><img src="https://i.imgur.com/O5sbaiB.png" height="100px;"></div><br><center><b><div style="font-size: 20px; font-family: georgia;">MARSHAL SERVICE</div><div style="font-size: 10px; line-height: 15px; font-family: georgia;">TACTICAL OPERATIONS CENTER
ONE JERRY NEWSON WAY,
NASHVILLE, TN 37201</div></b></center>

<div style="padding-left: 50px; padding-right: 50px;"><div style="text-align: right;">{{fragoDate}}</div>
From: {{fragoFrom}}<br>
To: {{fragoTo}}<br><br>
Subj: FRAGMENTARY ORDER #{{fragoNumber}} TO OPERATION ORDER {{fragoOpordNumber}} ({{fragoOpordDescriptor}})<br><br>
1. <u>Situation :</u> {{fragoSituation}}<br>
2. <u>Mission :</u> {{fragoMission}}<br>
3. <u>Exécution :</u> {{fragoExecution}}<br>
4. <u>Assistance technique</u> {{fragoSupport}}<br>
5. <u>Commandement et signal</u> {{fragoCommandSignal}}<br><br>

<div style="margin-left: 50%;"><img src="{{fragoSignatureLink}}" alt="SIGNATURE" height="100px;">
{{fragoSignatureName}}</div></div></td></tr></tbody></table></center></div>`
    });



    documentTemplates.push({
      id: 'administrativeClosure',
      group: 'Fermeture de dossier',
      label: 'Quatrième de couverture',
      description: 'Avis de clôture pour dossiers administratifs.',
      fields: [
        { id: 'closureMatricule', label: 'Matricule de référence', placeholder: 'X' },
        { id: 'closureFileNumber', label: 'Numéro de dossier', placeholder: 'X' },
        { id: 'closureAgents', label: 'Agents en charge', placeholder: 'X' },
        { id: 'closureDate', label: 'Date de clôture', placeholder: 'XX/XX/2025' },
        { id: 'closureReason', label: 'Motif', type: 'textarea', placeholder: 'X', rows: 4 }
      ],
      template: `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: #d2b89a; font-size: 15px; line-height: 1; border: 0px!important; padding: 0px!important; font-family: sans-serif; letter-spacing: 2px; color: #000000">
<tbody><tr><td align="center" valign="bottom">
<div style="background: white; padding: 15px; transform: rotate(7deg); position: relative; bottom: 600px; font-size: 12px; text-align: left; left: 200px; width: fit-content;"><center><div style="font-weight: bold; font-size: 25px; color: white; background-color: black; padding-left: 5px; padding-right: 5px;">ADMINISTRATIVE FILES</div>

<span style="font-weight: bold; font-size: 20px; color: red; font-family: times">CLÔTURE DU DOSSIER</span></center>
MATRICULE DE REFERENCE:

<div style="border: 1px solid black; padding: 10px; text-align: center;">{{closureMatricule}}</div>
<table style="border: 0px!important; padding: 0px!important;"><tbody><tr><td>NUMERO DE DOSSIER:
AGENTS EN CHARGE:

DATE DE CLÔTURE:</td>
<td>{{closureFileNumber}}
{{closureAgents}}
{{closureDate}}</td></tr></tbody></table>

MOTIF:

<div style="border: 1px solid black; padding: 10px; height: 100px">{{closureReason}}</div></div>
<b>DAVIDSON COUNTY SHERIFF'S OFFICE
MARSHAL SERVICE</b>

<div style="background: white; width: 350px; padding: 5px"><img src="https://barcode.tec-it.com/barcode.ashx?data=4 019643 846672&code=Code128&translate-esc=on"></div>
</b></td></tr></tbody></table></center>
</div>`
    });

    const templateSelect = document.getElementById('templateSelect');
    const templateFields = document.getElementById('templateFields');
    const templateDescription = document.getElementById('templateDescription');
    const sectionSelectControl = document.getElementById('sectionSelect');
    const templateGroupsOrder = [
      'Première de couverture',
      'Page de garde',
      'Contrat de protection personnelle',
      'Ordres',
      'Fermeture de dossier'
    ];
    let firstSelectableTemplateId = '';

    if (sectionSelectControl) {
      const activePanel = document.querySelector('.panel.active');
      if (activePanel) {
        sectionSelectControl.value = activePanel.id;
      }
    }

    function populateTemplateSelect() {
      if (!templateSelect) {
        return;
      }

      templateSelect.innerHTML = '';
      firstSelectableTemplateId = '';

      const groupedTemplates = new Map();
      documentTemplates.forEach(template => {
        const groupName = template.group || 'Autres';
        if (!groupedTemplates.has(groupName)) {
          groupedTemplates.set(groupName, []);
        }
        groupedTemplates.get(groupName).push(template);
      });

      const renderedGroups = new Set();

      const appendGroupOptions = groupName => {
        const groupTemplates = groupedTemplates.get(groupName);
        if (!groupTemplates) {
          return;
        }

        const optgroup = document.createElement('optgroup');
        optgroup.label = groupName;

        groupTemplates.forEach(template => {
          const option = document.createElement('option');
          option.value = template.id;
          option.textContent = template.label;
          if (!firstSelectableTemplateId) {
            firstSelectableTemplateId = template.id;
          }
          optgroup.append(option);
        });

        templateSelect.append(optgroup);
        renderedGroups.add(groupName);
      };

      templateGroupsOrder.forEach(appendGroupOptions);

      groupedTemplates.forEach((_, groupName) => {
        if (!renderedGroups.has(groupName)) {
          appendGroupOptions(groupName);
        }
      });

      if (!firstSelectableTemplateId && documentTemplates.length) {
        firstSelectableTemplateId = documentTemplates[0].id;
      }

      if (firstSelectableTemplateId) {
        templateSelect.value = firstSelectableTemplateId;
        renderTemplate(firstSelectableTemplateId);
      } else if (templateDescription) {
        templateDescription.textContent = '';
        if (templateFields) {
          templateFields.innerHTML = '';
        }
      }
    }

    function renderTemplate(templateId) {
      if (!templateFields || !templateDescription) {
        return;
      }

      const template = documentTemplates.find(item => item.id === templateId);
      if (!template) {
        templateDescription.textContent = '';
        templateFields.innerHTML = '';
        return;
      }

      templateDescription.textContent = template.description;
      templateFields.innerHTML = '';

      template.fields.forEach(field => {
        const wrapper = document.createElement('div');
        wrapper.className = `form-group${field.wide ? ' wide' : ''}`;

        const label = document.createElement('label');
        label.setAttribute('for', `field-${field.id}`);
        label.textContent = field.label;
        wrapper.append(label);

        let input;
        if (field.type === 'textarea') {
          input = document.createElement('textarea');
          if (field.rows) {
            input.rows = field.rows;
          }
          input.maxLength = field.maxLength ?? 2500;
        } else if (field.type === 'select') {
          input = document.createElement('select');
          input.dataset.allowCustom = field.allowCustom ? 'true' : 'false';
          input.dataset.lastValue = '';

          if (field.placeholder) {
            const placeholderOption = document.createElement('option');
            placeholderOption.value = '';
            placeholderOption.textContent = field.placeholder;
            placeholderOption.disabled = true;
            placeholderOption.hidden = true;
            placeholderOption.selected = true;
            input.append(placeholderOption);
          }

          if (Array.isArray(field.options)) {
            field.options.forEach(option => {
              const optionElement = document.createElement('option');
              if (typeof option === 'string') {
                optionElement.value = option;
                optionElement.textContent = option;
              } else {
                optionElement.value = option.value;
                optionElement.textContent = option.label;
                if (option.disabled) {
                  optionElement.disabled = true;
                }
              }
              input.append(optionElement);
            });
          }

          if (field.allowCustom) {
            const customOption = document.createElement('option');
            customOption.value = '__custom';
            customOption.textContent = 'Valeur personnalisée…';
            input.append(customOption);
          }

          input.addEventListener('change', handleTemplateSelectChange);
        } else {
          input = document.createElement('input');
          input.type = field.inputType || 'text';
        }

        input.id = `field-${field.id}`;
        if (field.type !== 'select') {
          input.placeholder = field.placeholder || '';
          if (field.maxLength && field.type !== 'textarea') {
            input.maxLength = field.maxLength;
          }
        }
        input.autocomplete = 'off';

        if (field.value !== undefined) {
          if (field.type === 'select') {
            input.value = field.value;
            input.dataset.lastValue = field.value;
          } else {
            input.value = field.value;
          }
        }

        if (field.readonly) {
          if (field.type === 'select') {
            input.disabled = true;
          } else {
            input.readOnly = true;
          }
          input.dataset.preserve = 'true';
        }

        if (field.disabled) {
          input.disabled = true;
          input.dataset.preserve = 'true';
        }

        if (field.preserve) {
          input.dataset.preserve = 'true';
        }

        wrapper.append(input);
        templateFields.append(wrapper);
      });
    }

    function generateDocumentBBCode() {
      if (!templateSelect) {
        return;
      }

      const template = documentTemplates.find(item => item.id === templateSelect.value);
      if (!template) {
        return;
      }

      const values = {};

      template.fields.forEach(field => {
        const input = document.getElementById(`field-${field.id}`);
        if (!input) {
          values[field.id] = '';
          return;
        }

        const rawValue = input.value;
        values[field.id] = field.type === 'textarea' || field.multiline ? formatMultiline(rawValue) : escapeHtml(rawValue);
      });

      let bbcode = template.template;
      template.fields.forEach(field => {
        const placeholder = `{{${field.id}}}`;
        bbcode = bbcode.replaceAll(placeholder, values[field.id] ?? '');
      });

      navigator.clipboard.writeText(bbcode);

      if (templateFields) {
        templateFields.querySelectorAll('input, textarea, select').forEach(field => {
          if (field.dataset.preserve === 'true') {
            return;
          }
          if (field.tagName === 'SELECT') {
            const selectElement = field;
            const customOption = selectElement.querySelector('option[data-custom="true"]');
            if (customOption) {
              customOption.remove();
            }
            const placeholderOption = selectElement.querySelector('option[disabled][hidden]');
            if (placeholderOption) {
              selectElement.selectedIndex = Array.from(selectElement.options).indexOf(placeholderOption);
            } else {
              selectElement.selectedIndex = 0;
            }
            selectElement.dataset.lastValue = '';
          } else {
            field.value = '';
          }
        });
      }

      showToast();
    }

    if (templateSelect) {
      populateTemplateSelect();
      templateSelect.addEventListener('change', () => renderTemplate(templateSelect.value));
    }

    function generateTerrainBBCode() {
      const reportNum = getFieldValue('reportNum');
      const date = getFieldValue('date');
      const name = getFieldValue('name');
      const signature = getFieldValue('signature');
      const refNo = getFieldValue('refNo');
      const refName = getFieldValue('refName');
      const page = getFieldValue('page');
      const content = getFieldValue('content', true);

      const reviewDate = 'N/A';

      const bbcode = `<div class="ampress-mb"><center><table style="width: 1005px; height: 1340px; background-color: white; font-size: 15px; border: 1px solid black!important; padding: 35px!important; font-family: georgia; color: #000000;"><tbody><tr><td align="left" valign="top"><center><img src="https://i.imgur.com/O5sbaiB.png" height="120px;"></center>REPORT: ${reportNum}<div style="float:right;">DATE: ${date}</div>
<center>OFFICIAL DOCUMENT
<div style="border-top: 1px solid black; border-bottom: 1px solid black; padding: 10px; font-weight: bold; margin-top: 5px; margin-bottom: 5px; letter-spacing: 3px; font-size: 20px;">MARSHAL SERVICE</div>FIELD REPORT</center>

${content}

<div style="margin-left: 50%;"><img src="${signature}" alt="SIGNATURE" height="100px;">
${name}</div></td></tr></tr><tr height="0px;"><td><center>FOR OFFICIAL USE ONLY</center>
File/Case Ref. No. # ${refNo} <div style="float:right;">Page: ${page}</div>

File/Case Ref. Name: ${refName} <div style="float:right;">Review Date: ${reviewDate}</div></td></tr></tbody></table></center></div>`;

      navigator.clipboard.writeText(bbcode);
      resetFields(document.getElementById('terrain'));
      showToast();
    }
  </script>
</body>
</html>
